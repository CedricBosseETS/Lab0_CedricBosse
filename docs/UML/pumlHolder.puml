@startuml
skinparam node {
  BackgroundColor #ECECEC
  BorderColor black
  FontSize 12
}

cloud "Internet" {
  [Client Web/Mobile]
}

node "Reverse Proxy (Traefik)" {
  [Entrée HTTPS]
}

node "Appwrite Core (docker service: appwrite)" {
  [Appwrite Server (PHP)]
}

node "Infrastructure" {
  database "MariaDB" as MariaDB
  database "Redis" as Redis
  component "MinIO (Object Storage)" as MinIO
}

node "Workers (queue/fn)" {
  component "Functions Executor"
  component "Queue Mail"
  component "Usage Collector"
}

[Client Web/Mobile] --> [Entrée HTTPS] : HTTPS request
[Entrée HTTPS] --> [Appwrite Server (PHP)] : Proxy pass

[Appwrite Server (PHP)] --> Redis : sessions, cache, queue
[Appwrite Server (PHP)] --> MariaDB : persistance des données
[Appwrite Server (PHP)] --> MinIO : stockage des fichiers, fonctions, logs

[Functions Executor] --> MinIO : récupère code fonctions, stocke logs
[Queue Mail] --> Redis : retire jobs
[Usage Collector] --> Redis : récupère données usage

@enduml
